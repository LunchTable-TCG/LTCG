---
title: Game API
description: Game loop and gameplay functions
---

## Overview

The Game API handles all gameplay-related operations including lobbies, matches, turns, and combat.

## Lobby

### Create Lobby

Create a new game lobby.

```typescript
// Mutation
api.gameplay.lobby.create

// Arguments
{
  gameMode: "ranked" | "casual" | "draft",
  deckId: Id<"decks">
}

// Returns
Id<"gameLobbies">
```

### Join Lobby

Join an existing lobby.

```typescript
// Mutation
api.gameplay.lobby.join

// Arguments
{
  lobbyId: Id<"gameLobbies">,
  deckId: Id<"decks">
}

// Returns
void
```

### Leave Lobby

Leave a lobby.

```typescript
// Mutation
api.gameplay.lobby.leave

// Arguments
{
  lobbyId: Id<"gameLobbies">
}

// Returns
void
```

### Start Game

Convert lobby to active game.

```typescript
// Mutation
api.gameplay.lobby.startGame

// Arguments
{
  lobbyId: Id<"gameLobbies">
}

// Returns
Id<"games">
```

## Games

### Get Game State

Subscribe to game state (real-time).

```typescript
// Query
api.gameplay.games.get

// Arguments
{
  gameId: Id<"games">
}

// Returns
{
  _id: Id<"games">,
  status: GameStatus,
  currentTurn: number,
  currentPhase: TurnPhase,
  activePlayerId: Id<"users">,
  player1: PlayerState,
  player2: PlayerState,
  turnHistory: Array<TurnAction>
}
```

### Surrender

Forfeit the current game.

```typescript
// Mutation
api.gameplay.games.surrender

// Arguments
{
  gameId: Id<"games">
}

// Returns
void
```

## Turn Actions

### Draw Card

Draw a card from deck (Draw Phase).

```typescript
// Mutation
api.gameplay.turns.drawCard

// Arguments
{
  gameId: Id<"games">
}

// Returns
CardInstance
```

### Play Card

Play a card from hand.

```typescript
// Mutation
api.gameplay.turns.playCard

// Arguments
{
  gameId: Id<"games">,
  cardInstanceId: string,
  targetZone: number,  // 0-3 for creatures, 0-2 for traps
  targets?: Array<string>  // For targeted effects
}

// Returns
void
```

### Declare Attack

Declare an attack with a creature.

```typescript
// Mutation
api.gameplay.turns.declareAttack

// Arguments
{
  gameId: Id<"games">,
  attackerId: string,
  targetId: string | "direct"  // Creature ID or "direct" for player
}

// Returns
CombatResult
```

### Activate Ability

Activate a creature's ability.

```typescript
// Mutation
api.gameplay.turns.activateAbility

// Arguments
{
  gameId: Id<"games">,
  sourceId: string,
  abilityIndex: number,
  targets?: Array<string>
}

// Returns
void
```

### End Phase

Move to the next phase.

```typescript
// Mutation
api.gameplay.turns.endPhase

// Arguments
{
  gameId: Id<"games">
}

// Returns
TurnPhase  // The new phase
```

### End Turn

End the current turn.

```typescript
// Mutation
api.gameplay.turns.endTurn

// Arguments
{
  gameId: Id<"games">
}

// Returns
void
```

## Trap Responses

### Activate Trap

Activate a face-down trap card.

```typescript
// Mutation
api.gameplay.traps.activate

// Arguments
{
  gameId: Id<"games">,
  trapId: string,
  targets?: Array<string>
}

// Returns
void
```

## Types

### GameStatus

```typescript
type GameStatus =
  | "waiting"   // In lobby
  | "active"    // Game in progress
  | "ended"     // Game finished
  | "abandoned";// Player disconnected
```

### TurnPhase

```typescript
type TurnPhase =
  | "draw"
  | "main1"
  | "battle"
  | "main2"
  | "end";
```

### PlayerState

```typescript
interface PlayerState {
  playerId: Id<"users">;
  lifePoints: number;
  mana: number;
  maxMana: number;
  hand: Array<CardInstance>;
  field: Array<CardInstance | null>;  // 4 creature slots
  traps: Array<CardInstance | null>;  // 3 trap slots
  graveyard: Array<CardInstance>;
  deck: number;  // Cards remaining
}
```

### CombatResult

```typescript
interface CombatResult {
  attackerDamage: number;
  defenderDamage: number;
  attackerDestroyed: boolean;
  defenderDestroyed: boolean;
  triggeredEffects: Array<Effect>;
}
```

---

## Next: Economy API

import { LinkCard } from '@astrojs/starlight/components';

<LinkCard
  title="Economy API"
  description="Shop, currency, and marketplace"
  href="/api-reference/economy/"
/>
