---
title: Production Deployment Guide
description: Step-by-step guide for deploying LTCG to production environments
lastUpdated: '2026-02-03'
tags: ['deployment', 'production', 'vercel', 'convex', 'operations']
---

# Production Deployment Guide

Complete guide for deploying the LTCG application to production on Vercel with Convex backend.

## Overview

LTCG consists of three deployable applications:
- **Web App** (`apps/web`) - Main player-facing application
- **Admin App** (`apps/admin`) - Internal admin dashboard
- **Docs Site** (`packages/docs`) - Documentation site

Each application deploys independently to Vercel, while sharing a single Convex production backend.

## Pre-Deployment Checklist

Before deploying to production, ensure all requirements are met:

### 1. Environment Setup

- [ ] Production Convex deployment created
- [ ] Production Privy app configured
- [ ] Environment variables documented
- [ ] Secrets stored securely (use Vercel encrypted variables)
- [ ] Domain names configured (if custom domains)

### 2. Database & Backend

- [ ] Convex schema deployed to production
- [ ] Database indexes verified in schema
- [ ] Convex functions tested in staging
- [ ] Migration scripts prepared (if needed)
- [ ] Backup strategy documented

### 3. Authentication & Security

- [ ] Privy production app created
- [ ] Allowed domains configured in Privy dashboard
- [ ] CORS settings verified
- [ ] Rate limiting configured
- [ ] RBAC roles verified

### 4. Treasury & Blockchain (if applicable)

- [ ] Solana mainnet RPC endpoint configured
- [ ] Treasury wallet created and funded
- [ ] Token mint addresses verified
- [ ] Wallet permissions configured

### 5. Monitoring & Observability

- [ ] Sentry project created for error tracking
- [ ] Vercel Analytics enabled
- [ ] Convex monitoring dashboard reviewed
- [ ] Alert thresholds configured
- [ ] On-call rotation established

## Environment Variables

### Required for All Apps

#### Convex Backend

```env
CONVEX_DEPLOYMENT=prod:your-deployment-name
NEXT_PUBLIC_CONVEX_URL=https://your-deployment.convex.cloud
```

**Setup**:
1. Create production deployment: `bunx convex deploy --prod`
2. Copy deployment URL from Convex dashboard
3. Add to Vercel environment variables

#### Privy Authentication

```env
NEXT_PUBLIC_PRIVY_APP_ID=priv_prod_xxxxxxxxxxxxx
PRIVY_APP_ID=priv_prod_xxxxxxxxxxxxx
PRIVY_APP_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**Setup**:
1. Create production app in [Privy Dashboard](https://dashboard.privy.io)
2. Configure allowed domains (your production domain)
3. Copy App ID and App Secret
4. Add to Vercel as encrypted environment variables

### Optional: Solana Integration

```env
NEXT_PUBLIC_SOLANA_RPC=https://mainnet.helius-rpc.com/?api-key=xxxxx
NEXT_PUBLIC_SOLANA_NETWORK=mainnet-beta
NEXT_PUBLIC_LTCG_TOKEN_MINT=YourTokenMintAddress111111111111111111
NEXT_PUBLIC_LTCG_TOKEN_DECIMALS=6
```

**Recommended RPC Providers**:
- [Helius](https://helius.xyz) - High performance, generous free tier
- [QuickNode](https://quicknode.com) - Enterprise-grade reliability
- [Alchemy](https://alchemy.com) - Comprehensive tooling

### Optional: Error Tracking

```env
NEXT_PUBLIC_SENTRY_DSN=https://xxxxx@xxxxx.ingest.sentry.io/xxxxx
SENTRY_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**Setup**:
1. Create project in [Sentry](https://sentry.io)
2. Copy DSN from project settings
3. Generate auth token for source maps

## Deployment Process

### Step 1: Deploy Convex Backend

Deploy the Convex backend before deploying frontend applications:

```bash
# From project root
bunx convex deploy --prod

# Verify deployment
bunx convex logs --prod --limit 20
```

**Verification**:
- Check Convex dashboard for successful deployment
- Verify all functions appear in Functions tab
- Check schema is applied correctly

### Step 2: Run Setup Scripts

Initialize production database with required data:

```bash
# Run complete setup (creates admin table, default data)
bunx convex run setup:setupComplete --prod

# Create superadmin user (use YOUR Privy user ID)
bunx convex run setup:setupSuperadmin \
  --privyUserId "did:privy:YOUR_PROD_PRIVY_ID" --prod

# Verify setup status
bunx convex run setup:checkSetupStatus --prod
```

**Expected Output**:
```
✓ Admin table initialized
✓ Default roles created
✓ Superadmin created: user@example.com
✓ Setup complete
```

### Step 3: Configure Vercel Projects

Create three separate Vercel projects:

#### Web App Configuration

```yaml
Project Name: ltcg-web
Root Directory: apps/web
Framework: Next.js
Build Command: cd ../.. && bun run build:web
Output Directory: .next
Install Command: cd ../.. && bun install
Node.js Version: 20.x
```

#### Admin App Configuration

```yaml
Project Name: ltcg-admin
Root Directory: apps/admin
Framework: Next.js
Build Command: cd ../.. && bun run build:admin
Output Directory: .next
Install Command: cd ../.. && bun install
Node.js Version: 20.x
```

#### Docs Site Configuration

```yaml
Project Name: ltcg-docs
Root Directory: packages/docs
Framework: Next.js
Build Command: cd ../.. && bun run build:docs
Output Directory: .next
Install Command: cd ../.. && bun install
Node.js Version: 20.x
```

### Step 4: Set Environment Variables

For each Vercel project:

1. Navigate to **Project Settings** → **Environment Variables**
2. Add all required variables (see Environment Variables section)
3. Set appropriate environment (Production, Preview, Development)
4. Use **Encrypted** option for secrets

**Production Environment**:
- Set variables for `Production` environment
- These are used for main branch deployments

**Preview Environment**:
- Optionally set different values for `Preview` environment
- Used for pull request deployments

### Step 5: Deploy Applications

#### Option A: Deploy via Git (Recommended)

Push to main branch to trigger automatic deployment:

```bash
git push origin main
```

Vercel automatically:
- Detects changes in each app directory
- Builds affected applications
- Deploys to production

#### Option B: Deploy via Vercel CLI

Manual deployment using Vercel CLI:

```bash
# Install Vercel CLI
bun add -g vercel

# Deploy web app
cd apps/web
vercel --prod

# Deploy admin app
cd ../admin
vercel --prod

# Deploy docs
cd ../../packages/docs
vercel --prod
```

### Step 6: Post-Deployment Verification

After deployment completes, verify each application:

#### Health Checks

**Web App**:
```bash
curl https://your-domain.com/api/health
# Expected: {"status": "ok", "convex": "connected"}
```

**Admin App**:
1. Navigate to admin URL
2. Log in with superadmin account
3. Verify dashboard loads
4. Check user list appears

**Docs Site**:
1. Navigate to docs URL
2. Verify all pages render
3. Check search functionality

#### Functional Verification

Test critical user journeys:

1. **Authentication Flow**
   - Sign up new user
   - Verify email sent
   - Log in successfully
   - Log out and log back in

2. **Game Creation**
   - Create new deck
   - Start practice game
   - Verify game state loads

3. **Shop Purchase**
   - Navigate to shop
   - Purchase pack with test currency
   - Open pack
   - Verify cards received

4. **Real-Time Updates**
   - Start multiplayer game (two browsers)
   - Make move in one browser
   - Verify move appears in other browser

## Database Migrations

For schema changes requiring data migration:

### Step 1: Prepare Migration Script

Create migration in `convex/migrations/`:

```typescript
// convex/migrations/2026_02_03_add_user_tier.ts
import { internalMutation } from "./_generated/server";

export default internalMutation(async (ctx) => {
  const users = await ctx.db.query("users").collect();

  for (const user of users) {
    await ctx.db.patch(user._id, {
      tier: "free", // Default tier for existing users
    });
  }

  console.log(`Migrated ${users.length} users`);
});
```

### Step 2: Test in Staging

Run migration against staging deployment:

```bash
bunx convex run migrations/2026_02_03_add_user_tier --deployment staging
```

### Step 3: Deploy Schema

Deploy updated schema to production:

```bash
bunx convex deploy --prod
```

### Step 4: Run Migration

Execute migration against production:

```bash
bunx convex run migrations/2026_02_03_add_user_tier --prod

# Monitor progress
bunx convex logs --prod --follow
```

### Step 5: Verify Migration

Check migration completed successfully:

```bash
# Query sample users
bunx convex run users:list --prod --limit 10

# Verify new field exists
```

## Rollback Procedures

If issues occur after deployment:

### Immediate Rollback (< 5 minutes)

Use Vercel dashboard to rollback:

1. Navigate to **Deployments** tab
2. Find last known good deployment
3. Click **⋯** → **Promote to Production**
4. Confirm rollback

### Backend Rollback

If Convex functions have issues:

```bash
# List recent deployments
bunx convex deployments list --prod

# Rollback to specific deployment
bunx convex rollback <deployment-id> --prod
```

### Database Rollback

For schema issues requiring data rollback:

1. **Stop writes**: Disable mutations via feature flag
2. **Restore backup**: Contact Convex support for backup restoration
3. **Verify data**: Check data integrity
4. **Re-enable writes**: Remove feature flag

## Monitoring Post-Deployment

Monitor these metrics for 24 hours after deployment:

### Application Metrics

- **Error Rate**: Should remain < 0.1%
- **Response Time**: P95 should be < 500ms
- **Traffic**: Monitor for unusual spikes or drops

### Convex Metrics

Monitor in [Convex Dashboard](https://dashboard.convex.dev):

- **Function Duration**: Check for slow queries
- **Function Errors**: Monitor error logs
- **Database Size**: Ensure no unexpected growth
- **Active Connections**: Monitor WebSocket connections

### Sentry Alerts

Check [Sentry Dashboard](https://sentry.io) for:

- New error types
- Increased error frequency
- User-reported issues

### User Feedback

Monitor support channels:

- Discord/community chat
- Email support
- Social media mentions

## Common Issues

### "Environment variable not found"

**Symptom**: Build fails with missing env var

**Solution**:
1. Verify variable exists in Vercel dashboard
2. Check variable is set for correct environment (Production/Preview)
3. Redeploy after adding variable

### "Convex connection failed"

**Symptom**: App loads but data doesn't appear

**Solution**:
1. Verify `NEXT_PUBLIC_CONVEX_URL` is correct
2. Check Convex deployment is active
3. Verify no CORS issues in browser console
4. Check Convex logs for errors

### "Privy authentication failed"

**Symptom**: Users can't log in

**Solution**:
1. Verify Privy app ID and secret are correct
2. Check production domain is allowed in Privy dashboard
3. Verify both `PRIVY_APP_ID` and `PRIVY_APP_SECRET` are set
4. Check browser console for specific error messages

### "Database migration failed"

**Symptom**: Migration script errors or times out

**Solution**:
1. Check migration script logic
2. Run against smaller dataset in staging
3. Consider batching large migrations
4. Monitor Convex dashboard for function timeout

### "Build succeeds but app won't start"

**Symptom**: Deployment succeeds but returns 500 error

**Solution**:
1. Check Vercel Function Logs
2. Verify all runtime environment variables are set
3. Check for Next.js config errors
4. Verify Bun version compatibility

## Security Checklist

Before going live:

- [ ] All secrets use encrypted environment variables
- [ ] CORS configured for production domains only
- [ ] Rate limiting enabled on authentication endpoints
- [ ] Admin routes protected with RBAC
- [ ] Privy webhook signatures verified
- [ ] HTTPS enforced (Vercel handles this automatically)
- [ ] Security headers configured (CSP, HSTS)
- [ ] Dependencies scanned for vulnerabilities

## Performance Optimization

### Frontend Optimization

- [ ] Enable Vercel Analytics
- [ ] Configure Image Optimization (Next.js Image component)
- [ ] Enable static page generation where possible
- [ ] Use dynamic imports for heavy components
- [ ] Enable compression (Vercel handles this automatically)

### Backend Optimization

- [ ] Review query indexes (see [Query Optimization](/guides/performance/query-optimization))
- [ ] Enable Convex caching where appropriate
- [ ] Monitor slow function execution
- [ ] Optimize database queries

## Related Documentation

- [Production Checklist](/develop/deployment/production-checklist) - Quick reference checklist
- [Environment Configuration](/integrate/environment-config) - Environment variable reference
- [Monitoring & Observability](/develop/operations/monitoring) - Monitoring setup
- [Query Optimization](/guides/performance/query-optimization) - Database performance
- [Testing Strategy](/develop/testing-strategy) - Pre-deployment testing
